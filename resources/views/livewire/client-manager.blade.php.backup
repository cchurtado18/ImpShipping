<div class="p-6 bg-white rounded-lg shadow-lg">
    <!-- Header -->
    <div class="mb-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800">Gestión de Clientes</h2>
            <button wire:click="addClient" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                Agregar Cliente
            </button>
        </div>

        <!-- Filtros -->
        <div class="flex flex-col sm:flex-row gap-4 mb-6">
            <div class="flex-1">
                <input wire:model.live="search" type="text" placeholder="Buscar por nombre, teléfono o email..." 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div class="sm:w-48">
                <select wire:model.live="statusFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">Todos los estados</option>
                    <option value="en_seguimiento">En Seguimiento</option>
                    <option value="confirmado">Confirmado</option>
                    <option value="proxima_ruta">Próxima Ruta</option>
                    <option value="ruta_cancelada">Ruta Cancelada</option>
                </select>
            </div>
            <div class="sm:w-48">
                <select wire:model.live="stateFilter" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <option value="">Todos los estados (EE.UU.)</option>
                    <option value="FL">Florida</option>
                    <option value="CA">California</option>
                    <option value="TX">Texas</option>
                    <option value="NY">New York</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="IL">Illinois</option>
                    <option value="OH">Ohio</option>
                    <option value="GA">Georgia</option>
                    <option value="NC">North Carolina</option>
                    <option value="MI">Michigan</option>
                    <option value="NJ">New Jersey</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="AZ">Arizona</option>
                    <option value="MA">Massachusetts</option>
                    <option value="TN">Tennessee</option>
                    <option value="IN">Indiana</option>
                    <option value="MO">Missouri</option>
                    <option value="MD">Maryland</option>
                    <option value="CO">Colorado</option>
                    <option value="MN">Minnesota</option>
                    <option value="WI">Wisconsin</option>
                    <option value="SC">South Carolina</option>
                    <option value="AL">Alabama</option>
                    <option value="LA">Louisiana</option>
                    <option value="KY">Kentucky</option>
                    <option value="OR">Oregon</option>
                    <option value="OK">Oklahoma</option>
                    <option value="CT">Connecticut</option>
                    <option value="UT">Utah</option>
                    <option value="IA">Iowa</option>
                    <option value="NV">Nevada</option>
                    <option value="AR">Arkansas</option>
                    <option value="MS">Mississippi</option>
                    <option value="KS">Kansas</option>
                    <option value="NE">Nebraska</option>
                    <option value="ID">Idaho</option>
                    <option value="NH">New Hampshire</option>
                    <option value="ME">Maine</option>
                    <option value="RI">Rhode Island</option>
                    <option value="HI">Hawaii</option>
                    <option value="MT">Montana</option>
                    <option value="DE">Delaware</option>
                    <option value="SD">South Dakota</option>
                    <option value="ND">North Dakota</option>
                    <option value="AK">Alaska</option>
                    <option value="VT">Vermont</option>
                    <option value="WY">Wyoming</option>
                    <option value="DC">District of Columbia</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Tabla de clientes -->
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contacto</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Envíos</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @forelse($clients as $client)
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div>
                            <div class="text-sm font-medium text-gray-900 flex items-center gap-2">
                                {{ $client->full_name }}
                                @if($client->client_type === 'subagency')
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                        Subagencia
                                    </span>
                                @endif
                            </div>
                            <div class="text-sm text-gray-500">{{ $client->us_address }}</div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ $client->us_phone }}</div>
                        @if($client->email)
                            <div class="text-sm text-gray-500">{{ $client->email }}</div>
                        @endif
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="text-sm rounded-full px-3 py-1 font-medium {{ $client->status_badge }}">
                            {{ $client->status_label }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        {{ $client->shipments_count ?? 0 }} envíos
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex flex-col space-y-1">
                            <button wire:click="editClient({{ $client->id }})" class="text-blue-600 hover:text-blue-900">Editar</button>
                            @if($client->status === 'confirmado')
                                <button 
                                    wire:click="$dispatch('openModal', { component: 'add-to-route-modal', arguments: { clientId: {{ $client->id }}, clientName: '{{ $client->full_name }}' }})"
                                    class="text-green-600 hover:text-green-900 text-xs">
                                    Agregar a ruta
                                </button>
                            @endif
                        </div>
                    </td>
                </tr>
                @empty
                <tr>
                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">No se encontraron clientes</td>
                </tr>
                @endforelse
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    <div class="mt-6">
        {{ $clients->links() }}
    </div>

        <!-- Modal de formulario -->
    @if($showForm)
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" wire:click="closeForm">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-auto" wire:click.stop>
            <!-- Header simple -->
            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-900">
                    {{ $editingClient ? 'Editar Cliente' : 'Agregar Nuevo Cliente' }}
                </h3>
                <button wire:click="closeForm" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Contenido -->
            <form id="client-form" wire:submit.prevent="saveClient" class="p-6 space-y-6">
                    <!-- Columna Izquierda -->
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Información del Cliente</h4>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre Completo *</label>
                                    <input wire:model="full_name" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('full_name') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono *</label>
                                    <input wire:model="us_phone" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('us_phone') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dirección de Domicilio *</label>
                                    <input wire:model="us_address" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('us_address') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input wire:model="email" type="email" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('email') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Estado *</label>
                                        <select wire:model="status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="en_seguimiento">En Seguimiento</option>
                                            <option value="confirmado">Confirmado</option>
                                            <option value="proxima_ruta">Próxima Ruta</option>
                                            <option value="ruta_cancelada">Ruta Cancelada</option>
                                        </select>
                                        @error('status') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Cliente *</label>
                                        <select wire:model.live="client_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="normal">Normal</option>
                                            <option value="subagency">Subagencia</option>
                                        </select>
                                        @error('client_type') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                        <!-- Tarifas de Subagencia -->
                        @if($client_type === 'subagency')
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Tarifas de Subagencia</h4>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Aéreo $/lb *</label>
                                    <input wire:model="air_rate_per_lb" type="number" step="0.0001" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('air_rate_per_lb') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Marítimo $/lb *</label>
                                    <input wire:model="sea_rate_per_lb" type="number" step="0.0001" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('sea_rate_per_lb') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pie cúbico $/ft³ *</label>
                                    <input wire:model="cubic_foot_rate" type="number" step="0.0001" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    @error('cubic_foot_rate') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                                </div>
                            </div>
                            
                            @error('subagency_tariffs') 
                            <div class="mt-3 p-3 bg-red-50 border border-red-200 rounded-md">
                                <span class="text-red-700 text-sm">{{ $message }}</span>
                            </div>
                            @enderror
                        </div>
                        @endif

                        <!-- Notas -->
                        <div>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4">Notas</h4>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Comentarios</label>
                                <textarea wire:model="notes" rows="6" placeholder="Información adicional sobre el cliente..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none"></textarea>
                                @error('notes') <span class="text-red-500 text-sm">{{ $message }}</span> @enderror
                            </div>
                        </div>
                    </div>
                </div>
            </form>
                
                <!-- Footer simple -->
                <div class="flex justify-end gap-3 p-6 border-t border-gray-200">
                    <button type="button" wire:click="closeForm" class="px-6 py-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200">
                        Cancelar
                    </button>
                    <button type="submit" form="client-form" class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                        {{ $editingClient ? 'Actualizar' : 'Guardar' }}
                    </button>
                </div>
            </div>
        </div>
    @endif
</div>
